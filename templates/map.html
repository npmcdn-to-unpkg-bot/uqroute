<!DOCTYPE html>
<html>
  	<head>
    <!-- Google analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-83224898-1', 'auto');
    ga('send', 'pageview');
    </script>
		<title>UQRoute - Success!</title>
		<link href="{{url_for('static', filename='css/bootstrap.min.css')}}" rel="stylesheet">
    	<link rel="shortcut icon" href="{{url_for('static', filename='favicon.png')}}">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
        <script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
        <script src="static/js/leaflet-routing-machine.js"></script>
	<script src="static/js/lrm-mapzen.js"></script>
	<link rel="stylesheet" href="static/js/leaflet.routing.mapzen.css">
    	<style>
			* {
				color: #0072bb;
			}
			html {
            position: relative;
            min-height: 100%;
			}

			body {
				margin-bottom: 25px;
			}
			#map {
				width: 100%;
				height: 400px;
			}
			.centalign {
				text-align: center;
			}
			.centalign img {
				margin: 0 auto;
			}
			.footer {
				position: absolute;
				bottom: 0;
				width: 100%;
				/* Set the fixed height of the footer here */
				height: 25px;
				text-align: center;
			}
			.footer a {
				text-decoration: none;
			}
			.blue {
				color: #0072bb;
				font-size: 20px;
			}
			.onehundred {
				width: 100%;
			}
			.results {
				font-size: 40px;
			}
    	</style>
  	</head>
  	<body>
    <section>
        <div class="container" id = "cont">
            <div class="row centalign">
                <a href="http://uqroute.com/"><img class="img-responsive img-center" src="static/LOGO.png" alt="" width="400" height="400"></a>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <!--<h1 class="section-heading">Section Heading</h1> -->
                    <p class="lead section-lead"><center>After some serious number crunching, we found the best route for you. <br/> Here's what we recommend...</p></center>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 onehundred">
                    <div id="map"></div>
                </div>
            </div>
            <br>
            <div class="row centalign onehundred blue">
                <div class="col-md-4 col-md-offset-1">
                    <img class="img-responsive img-center" src="static/DIS_LOGO.png" alt="" width="200" height="200">
                    <p class="blue">Your total walking distance is:</p>
                    <p class="blue results"> <span id="distance">0</span>m</p>
                </div>
                <div class="col-md-4 col-md-offset-2">
                    <img class="img-responsive img-center" src="static/CAL_LOGO.png" alt="" width="200" height="200">
                    <p class="blue">That's the equivalent of about: </p>
                    <p class="blue results"><span id=calories>0</span> calories</p>
                </div>
            </div>
        </div>
    </section>
    <div id="map"></div>
    <script type="text/javascript">
function createMap() {
    var nodes = [];

    {% for e in nodes %}
    nodes.push(
            L.latLng({{e["lat"]}}, {{e["lng"]}})
            );               
    {% endfor %}
    var map = L.map('map').setView([-27.4989042, 153.0131141], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'tgrkzus.18862nnb',
            accessToken: 'pk.eyJ1IjoidGdya3p1cyIsImEiOiJjaXNlbjZkaHowMGI4MnlydDk0cTI1aXZxIn0.baEJ-39wtc9AkyxDebjQHQ'
            }).addTo(map);

    var router = L.Routing.mapzen('valhalla-KAduFrX', {costing:"pedestrian"});
    var control = L.Routing.control({
        router: router,
        formatter: new L.Routing.mapzenFormatter(),
        waypoints: nodes
    }).addTo(map);

    //var distance = 0;
    //router.route(control.getWaypoints(), function(err, routes) {
    //    for (var i = 0; i < routes.length; i++) {
    //        distance += routes[i].summary.totalDistance;
    //    }
    //}

    //document.getElementById('distance').innerHTML = distance;
    //document.getElementById('calories').innerHTML = distance / 1000 * 70;

    //for (var i = 0; i < nodes.length; ++i) {
    //    L.marker(nodes[i]).addTo(map);
    //}

}
window.onload = createMap
    </script>
        </body>
        <footer class="footer">
            <div class="container center blue">
                <p>Created by <a href="https://github.com/tgrkzus">Tom Richardson</a>, <a href="https://au.linkedin.com/in/lachlan-jensen-6456b9117">Lachlan Jensen</a> & <a href="https://au.linkedin.com/in/nicholas-d-lambourne-07b782a2">Nicholas Lambourne</a></p>
                <p></p>Not affiliated with UQ</p>
            </div>
        </footer>
</html>
