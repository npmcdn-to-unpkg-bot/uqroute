<!DOCTYPE html>
<html>
  <head>
    <style>
#map {
        width: 100%;
        height: 400px;
     }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      function initMap() {
        var mapDiv = document.getElementById('map');
	var directionsService = new google.maps.DirectionsService();
	var directionsDisplay = new google.maps.DirectionsRenderer();
	var points = [];
	
	{% for e in nodes %}
		points.push({
			location: {
				lat: {{e["lat"]}},
				lng: {{e["lng"]}}
				}});
	{% endfor %}	


	//points.pop();
	//points.shift();
	var directionRequest = {
	origin: {
		lat: {{nodes[0]["lat"]}},
		lng: {{nodes[0]["lng"]}}
		},
	destination: { 
		lat: {{nodes[-1]["lat"]}},
		lng: {{nodes[-1]["lng"]}}
		},
	travelMode: 'WALKING',
	waypoints: points
	};
        var map = new google.maps.Map(mapDiv, {
		center: {
		lat: {{nodes[0]["lat"]}},
		lng: {{nodes[0]["lng"]}}
		},	
            	zoom: 16
        });
	directionsDisplay.setMap(map);
	
	directionsService.route(directionRequest, function(result, status) {
		if (status == 'OK') {
			directionsDisplay.setDirections(result);
		}
      });
}
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEyThZHPQoC29JrKGTmph-qxF2R3mVJXI&callback=initMap">
    </script>
  </body>
</html>
